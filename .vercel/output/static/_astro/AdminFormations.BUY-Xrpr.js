import{j as e,B as d,I as o,D as q,a as G,b as U,f as me,c as H}from"./input.Ax_aeIQF.js";import{R as n}from"./index.Dy7WD_uu.js";import{S as _,a as J,b as $,c as K,d as D,T as ue,e as he,f as w,g as l,h as pe,i}from"./select.BPMtuf4o.js";const je=[5,10,20,50,100],ge=["mariée","shooting","enfant","soirée","FX","mode","homme","beauté","artistique","initiation"];function ye(){const[z,X]=n.useState([]),[Z,I]=n.useState(!0),[v,Q]=n.useState(""),[p,W]=n.useState("all"),[f,Y]=n.useState("all"),[ee,j]=n.useState(!1),[m,E]=n.useState(null),[t,g]=n.useState({titre:"",description:"",content:"",notes:"",prix:"",image:"",imageAlt:"",icon:"",categorie:"",tags:"",steps:"",duree:"",durationMinutes:"",slug:"",isActive:!0,isFeatured:!1,certification:""}),[y,x]=n.useState(""),[A,N]=n.useState(!1),[M,C]=n.useState(null),[S,k]=n.useState(""),[b,h]=n.useState(1),[T,se]=n.useState(10),[u,R]=n.useState({key:"createdAt",dir:"desc"}),[O,te]=n.useState(0),[B,L]=n.useState(""),F=n.useCallback(()=>{I(!0);const s=new URLSearchParams({page:String(b),pageSize:String(T),sort:u.key,dir:u.dir});v&&s.append("search",v),p!=="all"&&s.append("categorie",p),f!=="all"&&s.append("isActive",f),fetch(`/api/formation-db?${s.toString()}`).then(a=>a.json()).then(a=>{X(a.data||[]),te(a.total||0),I(!1)}).catch(()=>I(!1))},[b,T,u,v,p,f]);n.useEffect(()=>{F()},[F]),n.useEffect(()=>{if(S){const s=setTimeout(()=>k(""),2500);return()=>clearTimeout(s)}},[S]);const r=s=>{const{name:a,value:c,type:oe,checked:de}=s.target;g(xe=>({...xe,[a]:oe==="checkbox"?de:c}))},ae=()=>{E(null),g({titre:"",description:"",content:"",notes:"",prix:"",image:"",imageAlt:"",icon:"",categorie:"",tags:"",steps:"",duree:"",durationMinutes:"",slug:"",isActive:!0,isFeatured:!1,certification:""}),j(!0),x("")},ie=s=>{E(s.id),g({...s,tags:Array.isArray(s.tags)?s.tags.join(", "):s.tags||"",steps:Array.isArray(s.steps)?s.steps.join(`
`):s.steps||"",prix:s.prix||"",duree:s.duree||"",durationMinutes:s.durationMinutes||"",image:s.image||"",imageAlt:s.imageAlt||"",icon:s.icon||"",content:s.content||"",notes:s.notes||"",slug:s.slug||""}),j(!0),x("")},ne=()=>{j(!1),E(null),x("")},le=async s=>{s.preventDefault(),N(!0),x("");const a={...t,prix:parseFloat(t.prix),durationMinutes:t.durationMinutes?parseInt(t.durationMinutes,10):null,tags:Array.isArray(t.tags)?t.tags:t.tags.split(",").map(c=>c.trim()).filter(Boolean),steps:t.steps.split(`
`).map(c=>c.trim()).filter(Boolean),isActive:!!t.isActive,isFeatured:!!t.isFeatured};try{(await fetch("/api/formation-db",{method:m?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m?{...a,id:m}:a)})).ok?(k(m?"Formation modifiée !":"Formation ajoutée !"),j(!1),F()):x("Erreur lors de l'enregistrement.")}catch{x("Erreur réseau.")}N(!1)},re=async()=>{if(M){N(!0),x("");try{(await fetch("/api/formation-db",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:M})})).ok?(k("Formation supprimée !"),C(null),F()):x("Erreur lors de la suppression.")}catch{x("Erreur réseau.")}N(!1)}},V=s=>{s&&s.preventDefault();const a=B.trim();!a||(Array.isArray(t.tags)?t.tags.includes(a):t.tags.split(",").map(c=>c.trim()).includes(a))||(g(c=>({...c,tags:Array.isArray(c.tags)?[...c.tags,a]:[a]})),L(""))},ce=s=>{g(a=>({...a,tags:Array.isArray(a.tags)?a.tags.filter(c=>c!==s):[]}))},P=Math.max(1,Math.ceil(O/T));return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Formations"}),e.jsx(d,{onClick:ae,children:"Ajouter"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 items-end",children:[e.jsx(o,{placeholder:"Recherche (titre, description, catégorie, tags, content, notes)",value:v,onChange:s=>{Q(s.target.value),h(1)},className:"w-64"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Catégorie"}),e.jsx(o,{name:"categorieFilter",value:p==="all"?"":p,onChange:s=>{W(s.target.value||"all"),h(1)},className:"w-32",placeholder:"Toutes"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Active"}),e.jsxs(_,{value:f,onValueChange:s=>{Y(s),h(1)},children:[e.jsx(J,{className:"w-24",children:e.jsx($,{placeholder:"Toutes"})}),e.jsxs(K,{children:[e.jsx(D,{value:"all",children:"Toutes"}),e.jsx(D,{value:"true",children:"Oui"}),e.jsx(D,{value:"false",children:"Non"})]})]})]})]}),e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(w,{children:[e.jsxs(l,{className:"cursor-pointer",onClick:()=>R(s=>({key:"titre",dir:s.key==="titre"&&s.dir==="asc"?"desc":"asc"})),children:["Titre ",u.key==="titre"?u.dir==="asc"?"▲":"▼":null]}),e.jsx(l,{children:"Description"}),e.jsx(l,{children:"Content"}),e.jsx(l,{children:"Notes"}),e.jsxs(l,{className:"cursor-pointer",onClick:()=>R(s=>({key:"prix",dir:s.key==="prix"&&s.dir==="asc"?"desc":"asc"})),children:["Prix ",u.key==="prix"?u.dir==="asc"?"▲":"▼":null]}),e.jsx(l,{children:"Catégorie"}),e.jsx(l,{children:"Durée"}),e.jsx(l,{children:"Durée (min)"}),e.jsx(l,{children:"Tags"}),e.jsx(l,{children:"Steps"}),e.jsx(l,{children:"Image"}),e.jsx(l,{children:"Image Alt"}),e.jsx(l,{children:"Icon"}),e.jsx(l,{children:"Active"}),e.jsx(l,{children:"Vedette"}),e.jsx(l,{children:"Certification"}),e.jsx(l,{children:"createdAt"}),e.jsx(l,{children:"updatedAt"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(pe,{children:Z?e.jsx(w,{children:e.jsx(i,{colSpan:10,children:"Chargement…"})}):z.length===0?e.jsx(w,{children:e.jsx(i,{colSpan:10,children:"Aucune formation."})}):z.map(s=>e.jsxs(w,{children:[e.jsx(i,{children:s.titre}),e.jsx(i,{children:s.description}),e.jsx(i,{children:s.content}),e.jsx(i,{children:s.notes}),e.jsxs(i,{children:[s.prix," €"]}),e.jsx(i,{children:s.categorie}),e.jsx(i,{children:s.duree}),e.jsx(i,{children:s.durationMinutes}),e.jsx(i,{children:s.tags&&s.tags.length>0?s.tags.join(", "):""}),e.jsx(i,{children:s.steps&&s.steps.length>0?s.steps.join(" | "):""}),e.jsx(i,{children:s.image}),e.jsx(i,{children:s.imageAlt}),e.jsx(i,{children:s.icon}),e.jsx(i,{children:s.isActive?"Oui":"Non"}),e.jsx(i,{children:s.isFeatured?"Oui":"Non"}),e.jsx(i,{children:s.certification||""}),e.jsx(i,{children:s.createdAt?s.createdAt.slice(0,10):""}),e.jsx(i,{children:s.updatedAt?s.updatedAt.slice(0,10):""}),e.jsxs(i,{children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>ie(s),children:"Éditer"}),e.jsx(d,{variant:"destructive",size:"sm",onClick:()=>C(s.id),children:"Supprimer"})]})]},s.id))})]}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center mt-4 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["Page ",b," / ",P]}),e.jsxs(_,{value:String(T),onValueChange:s=>{se(Number(s)),h(1)},children:[e.jsx(J,{className:"w-20",children:e.jsx($,{})}),e.jsx(K,{children:je.map(s=>e.jsxs(D,{value:String(s),children:[s," / page"]},s))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[b>1&&e.jsx(d,{type:"button",size:"sm",variant:"secondary",onClick:()=>h(s=>Math.max(1,s-1)),"aria-label":"Page précédente",children:"Précédent"}),b<P&&e.jsx(d,{type:"button",size:"sm",variant:"secondary",onClick:()=>h(s=>Math.min(P,s+1)),"aria-label":"Page suivante",children:"Suivant"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[O," formation",O>1?"s":""]})]}),e.jsx(q,{open:ee,onOpenChange:j,children:e.jsxs(G,{children:[e.jsx(U,{children:m?"Modifier la formation":"Créer une formation"}),e.jsx(me,{children:m?"Modifiez les informations de la formation.":"Remplissez le formulaire pour ajouter une nouvelle formation."}),e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Titre"}),e.jsx(o,{name:"titre",value:t.titre,onChange:r,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Description"}),e.jsx(o,{name:"description",value:t.description,onChange:r,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Contenu détaillé"}),e.jsx("textarea",{name:"content",value:t.content,onChange:r,className:"w-full border rounded px-3 py-2 min-h-[60px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Notes internes"}),e.jsx("textarea",{name:"notes",value:t.notes,onChange:r,className:"w-full border rounded px-3 py-2 min-h-[40px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Icon (nom ou URL)"}),e.jsx(o,{name:"icon",value:t.icon,onChange:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:(Array.isArray(t.tags)?t.tags:t.tags.split(",").map(s=>s.trim()).filter(Boolean)).map(s=>e.jsxs("span",{className:"inline-flex items-center bg-gray-200 rounded px-2 py-0.5 text-xs",children:[s,e.jsx("button",{type:"button",className:"ml-1 text-red-500 hover:text-red-700",onClick:()=>ce(s),"aria-label":`Supprimer ${s}`,children:"×"})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{value:B,onChange:s=>L(s.target.value),placeholder:"Ajouter un tag...",list:"formation-tag-suggestions",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),V(s))},"aria-label":"Ajouter un tag"}),e.jsx(d,{type:"button",size:"sm",variant:"secondary",onClick:V,children:"Ajouter"})]}),e.jsx("datalist",{id:"formation-tag-suggestions",children:ge.filter(s=>!(Array.isArray(t.tags)?t.tags:t.tags.split(",").map(a=>a.trim())).includes(s)).map(s=>e.jsx("option",{value:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Étapes (une par ligne)"}),e.jsx("textarea",{name:"steps",value:t.steps,onChange:r,className:"w-full border rounded px-3 py-2 min-h-[60px]",placeholder:"ex: Préparation\\nApplication du fond de teint\\nFinitions..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Durée"}),e.jsx(o,{name:"duree",value:t.duree,onChange:r,placeholder:"ex: 2 jours, 3h, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Durée (minutes)"}),e.jsx(o,{name:"durationMinutes",value:t.durationMinutes,onChange:r,type:"number",min:"0",placeholder:"ex: 120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Slug"}),e.jsx(o,{name:"slug",value:t.slug,onChange:r,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Certification"}),e.jsx(o,{name:"certification",value:t.certification,onChange:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Image (URL)"}),e.jsx(o,{name:"image",value:t.image,onChange:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Texte alternatif image (accessibilité)"}),e.jsx(o,{name:"imageAlt",value:t.imageAlt,onChange:r})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"isActive",checked:!!t.isActive,onChange:r,id:"isActive"}),e.jsx("label",{htmlFor:"isActive",className:"text-xs font-semibold",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"isFeatured",checked:!!t.isFeatured,onChange:r,id:"isFeatured"}),e.jsx("label",{htmlFor:"isFeatured",className:"text-xs font-semibold",children:"Vedette"})]})]}),e.jsxs(H,{children:[e.jsx(d,{type:"button",variant:"secondary",onClick:ne,disabled:A,children:"Annuler"}),e.jsx(d,{type:"submit",variant:"default",disabled:A,children:m?"Enregistrer":"Ajouter"})]}),y&&e.jsx("div",{className:"text-sm text-center text-red-600 mt-2",children:y})]})]})}),e.jsx(q,{open:!!M,onOpenChange:s=>{s||C(null)},children:e.jsxs(G,{children:[e.jsx(U,{children:"Supprimer la formation ?"}),e.jsx("div",{children:"Cette action est irréversible."}),e.jsxs(H,{children:[e.jsx(d,{type:"button",variant:"secondary",onClick:()=>C(null),disabled:A,children:"Annuler"}),e.jsx(d,{type:"button",variant:"destructive",onClick:re,disabled:A,children:"Supprimer"})]}),y&&e.jsx("div",{className:"text-sm text-center text-red-600 mt-2",children:y})]})}),S&&e.jsxs("div",{role:"status","aria-live":"polite",className:"fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow-lg animate-fade-in z-50",children:[S,e.jsx("button",{onClick:()=>k(""),className:"ml-4 text-white/80 hover:text-white font-bold",children:"×"})]})]})}export{ye as default};
