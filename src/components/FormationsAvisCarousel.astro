---
import Alert from './starwind/alert/Alert.astro';
import db from '@lib/db';

let avis = [];
try {
  // Récupérer directement depuis la DB les avis des formations
  avis = db.prepare('SELECT * FROM avis WHERE formationsGlobal = 1 ORDER BY id ASC').all();
} catch (e) {
  console.error('Error fetching formations avis:', e);
  avis = [];
}
---
{avis.length > 0 ? (
  <div class="w-full overflow-x-auto py-4">
    <div class="flex gap-6 min-w-full">
      {avis.map((a: { utilisateur?: string; nom?: string; commentaire: string; note: number }) => (
        <div class="luxury-glass-effect p-8 rounded-2xl min-w-[320px] max-w-xs flex-shrink-0 border border-luxury-primary/20 hover:border-luxury-primary/40 transition-all duration-500 hover:scale-105">
          <div class="flex items-center mb-4">
            <div class="w-12 h-12 bg-luxury-primary/10 rounded-full flex items-center justify-center mr-4">
              <span class="text-luxury-primary font-medium text-lg">
                {(a.utilisateur || a.nom || 'A').charAt(0).toUpperCase()}
              </span>
            </div>
            <div>
              <div class="font-medium text-luxury-primary">{a.utilisateur || a.nom}</div>
              <div class="flex text-luxury-secondary text-sm">
                {'★'.repeat(a.note)}{'☆'.repeat(5 - a.note)}
              </div>
            </div>
          </div>
          <p class="text-neutral-600 leading-relaxed italic">"{a.commentaire}"</p>
        </div>
      ))}
    </div>
  </div>
) : (
  <div class="luxury-glass-effect p-12 rounded-2xl text-center">
    <div class="text-luxury-primary/60 mb-4">✦</div>
    <p class="text-neutral-500">Plus de témoignages à venir prochainement.</p>
  </div>
)}
