---
import Layout from '../layouts/Layout.astro';
import db from '../lib/db';

// Get site identity information
let siteInfo: any = {};
try {
  siteInfo = db.prepare('SELECT * FROM site_identity LIMIT 1').get() || {};
} catch (error) {
  console.error('Error fetching site info:', error);
}
---

<Layout>
  <!-- Luxury Hero Section -->
  <section class="section-luxury-hero relative min-h-[60vh] flex items-center overflow-hidden">
    <!-- Background Decorative Elements -->
    <div class="absolute top-20 left-10 w-40 h-40 bg-luxury-primary/10 rounded-full blur-3xl animate-luxury-fade-in"></div>
    <div class="absolute bottom-20 right-10 w-60 h-60 bg-luxury-secondary/10 rounded-full blur-3xl animate-luxury-fade-in" style="animation-delay: 0.5s;"></div>
    <div class="absolute top-1/3 right-1/4 w-20 h-20 bg-luxury-accent/20 rounded-full blur-2xl"></div>
    
    <div class="container mx-auto px-6 lg:px-8 relative z-10 text-center">
      <div class="animate-luxury-slide-in">
        <div class="font-accent text-luxury-primary uppercase tracking-widest text-sm mb-4">
          Contact ‚Ä¢ Artisan Beauty
        </div>
        
        <h1 class="text-hero font-heading mb-6 leading-tight">
          Une Question ?
          <span class="block text-luxury-secondary">Contactez-nous</span>
        </h1>
        
        <p class="text-subtitle mb-8 max-w-2xl mx-auto">
          Nous sommes l√† pour vous accompagner dans votre d√©marche beaut√© avec expertise et bienveillance.
        </p>
      </div>
    </div>
  </section>

  <!-- Main Content Section -->
  <section class="section-luxury py-16">
    <div class="container mx-auto px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-start">
        <!-- Contact Information -->
        <div class="space-y-12 animate-luxury-slide-in">
          <div>
            <h2 class="text-display font-heading text-luxury-primary mb-8">Nos Coordonn√©es</h2>
            
            <div class="space-y-6">
              {siteInfo.adresse && (
                <div class="flex items-start gap-4 p-4 bg-luxury-cream/30 rounded-xl hover:bg-luxury-cream/50 transition-colors duration-300">
                  <div class="text-luxury-primary text-2xl mt-1">üìç</div>
                  <div>
                    <div class="font-medium text-luxury-charcoal mb-1">Adresse</div>
                    <div class="text-luxury-taupe">
                      {siteInfo.adresse}<br />
                      {siteInfo.codePostal} {siteInfo.ville}
                      {siteInfo.pays && <>, {siteInfo.pays}</>}
                    </div>
                  </div>
                </div>
              )}
              
              {siteInfo.telephone && (
                <div class="flex items-start gap-4 p-4 bg-luxury-cream/30 rounded-xl hover:bg-luxury-cream/50 transition-colors duration-300">
                  <div class="text-luxury-primary text-2xl mt-1">üìû</div>
                  <div>
                    <div class="font-medium text-luxury-charcoal mb-1">T√©l√©phone</div>
                    <a href={`tel:${siteInfo.telephone}`} class="text-luxury-taupe hover:text-luxury-primary transition-colors duration-300">
                      {siteInfo.telephone}
                    </a>
                  </div>
                </div>
              )}
              
              {siteInfo.email && (
                <div class="flex items-start gap-4 p-4 bg-luxury-cream/30 rounded-xl hover:bg-luxury-cream/50 transition-colors duration-300">
                  <div class="text-luxury-primary text-2xl mt-1">üìß</div>
                  <div>
                    <div class="font-medium text-luxury-charcoal mb-1">Email</div>
                    <a href={`mailto:${siteInfo.email}`} class="text-luxury-taupe hover:text-luxury-primary transition-colors duration-300">
                      {siteInfo.email}
                    </a>
                  </div>
                </div>
              )}
            </div>
          </div>

          <!-- Enhanced Information Cards -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            <div class="card-luxury p-6 text-center animate-luxury-scale-in" style="animation-delay: 0.2s;">
              <h3 class="text-title font-heading text-luxury-primary mb-3">Horaires d'ouverture</h3>
              <div class="text-luxury-taupe space-y-1 text-sm">
                {siteInfo.horaires ? (
                  <div class="whitespace-pre-line">{siteInfo.horaires}</div>
                ) : (
                  <>
                    <div>Lundi - Vendredi : 9h - 18h</div>
                    <div>Samedi : 9h - 17h</div>
                    <div>Dimanche : Sur rendez-vous</div>
                  </>
                )}
              </div>
            </div>
            
            <div class="card-luxury p-6 text-center animate-luxury-scale-in" style="animation-delay: 0.4s;">
              <h3 class="text-title font-heading text-luxury-primary mb-3">Suivez-nous</h3>
              <div class="flex justify-center gap-4 flex-wrap">
                {siteInfo.facebook && (
                  <a href={siteInfo.facebook} target="_blank" rel="noopener noreferrer" class="text-luxury-taupe hover:text-luxury-primary transition-colors duration-300 transform hover:scale-110">Facebook</a>
                )}
                {siteInfo.instagram && (
                  <a href={siteInfo.instagram} target="_blank" rel="noopener noreferrer" class="text-luxury-taupe hover:text-luxury-primary transition-colors duration-300 transform hover:scale-110">Instagram</a>
                )}
                {siteInfo.linkedin && (
                  <a href={siteInfo.linkedin} target="_blank" rel="noopener noreferrer" class="text-luxury-taupe hover:text-luxury-primary transition-colors duration-300 transform hover:scale-110">LinkedIn</a>
                )}
                {siteInfo.youtube && (
                  <a href={siteInfo.youtube} target="_blank" rel="noopener noreferrer" class="text-luxury-taupe hover:text-luxury-primary transition-colors duration-300 transform hover:scale-110">YouTube</a>
                )}
                {!siteInfo.facebook && !siteInfo.instagram && !siteInfo.linkedin && !siteInfo.youtube && (
                  <>
                    <a href="https://facebook.com/maquilleuse.annecy" class="text-luxury-taupe hover:text-luxury-primary transition-colors duration-300 transform hover:scale-110">Facebook</a>
                    <a href="https://instagram.com/maquilleuse_annecy" class="text-luxury-taupe hover:text-luxury-primary transition-colors duration-300 transform hover:scale-110">Instagram</a>
                    <a href="https://linkedin.com/in/maquilleuse-annecy" class="text-luxury-taupe hover:text-luxury-primary transition-colors duration-300 transform hover:scale-110">LinkedIn</a>
                  </>
                )}
              </div>
            </div>
          </div>
          
          <!-- Luxury Quick Links -->
          <div class="card-luxury-featured p-8 animate-luxury-scale-in" style="animation-delay: 0.6s;">
            <h3 class="text-title font-heading text-luxury-primary mb-6 text-center">Liens Rapides</h3>
            <div class="grid grid-cols-2 gap-4">
              <a href="/reservations" class="flex items-center gap-2 text-luxury-taupe hover:text-luxury-primary transition-all duration-300 group">
                <span class="text-luxury-primary group-hover:translate-x-1 transition-transform">‚Üí</span>
                <span class="text-sm">R√©server une prestation</span>
              </a>
              <a href="/services" class="flex items-center gap-2 text-luxury-taupe hover:text-luxury-primary transition-all duration-300 group">
                <span class="text-luxury-primary group-hover:translate-x-1 transition-transform">‚Üí</span>
                <span class="text-sm">D√©couvrir nos services</span>
              </a>
              <a href="/formations" class="flex items-center gap-2 text-luxury-taupe hover:text-luxury-primary transition-all duration-300 group">
                <span class="text-luxury-primary group-hover:translate-x-1 transition-transform">‚Üí</span>
                <span class="text-sm">Nos formations</span>
              </a>
              <a href="/galerie" class="flex items-center gap-2 text-luxury-taupe hover:text-luxury-primary transition-all duration-300 group">
                <span class="text-luxury-primary group-hover:translate-x-1 transition-transform">‚Üí</span>
                <span class="text-sm">Voir notre galerie</span>
              </a>
            </div>
          </div>
        </div>

        <!-- Contact Form -->
        <div class="animate-luxury-slide-in" style="animation-delay: 0.3s;">
          <div class="card-luxury p-8">
            <h2 class="text-display font-heading text-luxury-primary mb-8 text-center">Envoyez-nous un Message</h2>
            <form id="contact-form" class="space-y-6">
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div>
                  <label for="prenom" class="form-label">
                    Pr√©nom <span class="form-required">*</span>
                  </label>
                  <input 
                    id="prenom"
                    type="text" 
                    name="prenom" 
                    required 
                    class="form-input" 
                    placeholder="Votre pr√©nom"
                  />
                </div>
                <div>
                  <label for="nom" class="form-label">
                    Nom <span class="form-required">*</span>
                  </label>
                  <input 
                    id="nom"
                    type="text" 
                    name="nom" 
                    required 
                    class="form-input" 
                    placeholder="Votre nom"
                  />
                </div>
              </div>
              
              <div>
                <label for="email" class="form-label">
                  Email <span class="form-required">*</span>
                </label>
                <input 
                  id="email"
                  type="email" 
                  name="email" 
                  required 
                  class="form-input" 
                  placeholder="votre@email.com"
                />
              </div>
              
              <div>
                <label for="telephone" class="form-label">
                  T√©l√©phone
                </label>
                <input 
                  id="telephone"
                  type="tel" 
                  name="telephone" 
                  class="form-input" 
                  placeholder="06 12 34 56 78"
                />
              </div>
              
              <div>
                <label for="sujet" class="form-label">
                  Sujet <span class="form-required">*</span>
                </label>
                <select 
                  id="sujet"
                  name="sujet" 
                  required 
                  class="form-select"
                >
                  <option value="">Choisissez un sujet...</option>
                  <option value="reservation">Demande de r√©servation</option>
                  <option value="information">Demande d'information</option>
                  <option value="formation">Question sur les formations</option>
                  <option value="devis">Demande de devis</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              
              <div>
                <label for="message" class="form-label">
                  Message <span class="form-required">*</span>
                </label>
                <textarea 
                  id="message"
                  name="message" 
                  required 
                  rows="5" 
                  class="form-textarea" 
                  placeholder="D√©crivez votre demande, vos besoins, vos questions..."
                ></textarea>
              </div>
              
              <button type="submit" class="btn-luxury-primary w-full animate-luxury-scale-in" style="animation-delay: 0.8s;">
                Envoyer le message
              </button>
              
              <div id="contact-feedback" class="mt-4 text-center"></div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script type="module">
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('contact-form');
      const feedback = document.getElementById('contact-feedback');
      
      if (form) {
        form.onsubmit = async function(e) {
          e.preventDefault();
          feedback.textContent = '';
          
          const formData = new FormData(form);
          const data = {
            prenom: formData.get('prenom')?.toString().trim(),
            nom: formData.get('nom')?.toString().trim(),
            email: formData.get('email')?.toString().trim(),
            telephone: formData.get('telephone')?.toString().trim(),
            sujet: formData.get('sujet')?.toString().trim(),
            message: formData.get('message')?.toString().trim()
          };
          
          // Basic validation
          if (!data.prenom || !data.nom || !data.email || !data.sujet || !data.message) {
            feedback.textContent = 'Veuillez remplir tous les champs obligatoires.';
            feedback.className = 'mt-4 text-center text-red-600 bg-red-50 p-3 rounded';
            return;
          }
          
          const submitBtn = form.querySelector('button[type="submit"]');
          const originalText = submitBtn.textContent;
          submitBtn.disabled = true;
          submitBtn.textContent = 'Envoi en cours...';
          
          try {
            const res = await fetch('/api/contact', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data)
            });
            
            if (res.ok) {
              form.reset();
              feedback.textContent = 'Message envoy√© avec succ√®s ! Nous vous recontacterons tr√®s prochainement.';
              feedback.className = 'mt-4 text-center text-green-700 bg-green-50 p-3 rounded';
            } else {
              throw new Error('Erreur serveur');
            }
          } catch (error) {
            feedback.textContent = "Erreur lors de l'envoi. Merci de r√©essayer ou de nous contacter directement par t√©l√©phone.";
            feedback.className = 'mt-4 text-center text-red-600 bg-red-50 p-3 rounded';
          }
          
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
        };
      }
    });
  </script>
</Layout>
