---
import Layout from '@layouts/Layout.astro';
import Card from '../../components/starwind/card/Card.astro';
import CardContent from '../../components/starwind/card/CardContent.astro';
import CardTitle from '../../components/starwind/card/CardTitle.astro';
import Badge from '../../components/starwind/badge/Badge.astro';
import Button from '../../components/starwind/button/Button.astro';
import ServiceAvisSummary from '../../components/ServiceAvisSummary.astro';
import ServicesAvisCarousel from '../../components/ServicesAvisCarousel.astro';
import ServicesGalleryCarousel from '../../components/ServicesGalleryCarousel.astro';
import ServicesFaqList from '../../components/ServicesFaqList.astro';

import db from '@lib/db';
import type { Service } from '../../types/Service';
let services: Service[] = [];
try {
  services = db.prepare('SELECT * FROM services ORDER BY id ASC').all() as Service[];
} catch (e) {
  services = [];
}

// R√©cup√©rer toutes les FAQ, avis, images globales pour les services
let allServiceFaqs: any[] = [];
let allServiceAvis: any[] = [];
let allServiceImages: any[] = [];
try {
  allServiceFaqs = db.prepare('SELECT * FROM faq WHERE servicesGlobal = 1 ORDER BY id ASC').all();
  allServiceAvis = db.prepare('SELECT * FROM avis WHERE servicesGlobal = 1 ORDER BY id ASC').all();
  allServiceImages = db.prepare('SELECT * FROM galerie WHERE servicesGlobal = 1 ORDER BY id ASC').all();
} catch {}
---
<Layout>
  {/* Hero section */}
  <section class="section-luxury-hero relative min-h-[70vh] flex items-center overflow-hidden">
    {/* Background Decorative Elements */}
    <div class="absolute top-20 left-10 w-40 h-40 bg-luxury-primary/10 rounded-full blur-3xl animate-luxury-fade-in"></div>
    <div class="absolute bottom-20 right-10 w-60 h-60 bg-luxury-secondary/10 rounded-full blur-3xl animate-luxury-fade-in" style="animation-delay: 0.5s;"></div>
    <div class="absolute top-1/3 right-1/4 w-20 h-20 bg-luxury-accent/20 rounded-full blur-2xl"></div>
    
    <div class="container mx-auto px-6 lg:px-8 relative z-10">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
        {/* Hero Content */}
        <div class="text-center lg:text-left animate-luxury-slide-in">
          <div class="font-accent text-luxury-primary uppercase tracking-widest text-sm mb-4">
            Services Premium ‚Ä¢ Annecy
          </div>
          
          <h1 class="text-hero font-heading mb-8 leading-tight">
            Nos Services de
            <span class="block text-luxury-secondary">Maquillage d'Exception</span>
          </h1>
          
          <p class="text-subtitle mb-12 max-w-2xl mx-auto lg:mx-0">
            Maquillage professionnel, artistique, √©v√©nementiel ou formation : sublimez chaque moment avec l'expertise d'une maquilleuse passionn√©e et des techniques avant-gardistes.
          </p>
          
          <div class="flex flex-col sm:flex-row gap-6 justify-center lg:justify-start mb-12">
            <a href="/contact" class="btn-luxury-primary animate-luxury-scale-in" style="animation-delay: 0.3s;">
              Demander un devis
            </a>
            <a href="#services" class="btn-luxury-secondary animate-luxury-scale-in" style="animation-delay: 0.6s;">
              D√©couvrir nos services
            </a>
          </div>
          
          <div class="flex flex-col sm:flex-row gap-8 justify-center lg:justify-start text-center">
            <div class="animate-luxury-scale-in" style="animation-delay: 0.4s;">
              <div class="text-luxury-primary text-2xl font-heading mb-1">+10</div>
              <div class="text-luxury-taupe text-sm">Services sp√©cialis√©s</div>
            </div>
            <div class="animate-luxury-scale-in" style="animation-delay: 0.6s;">
              <div class="text-luxury-primary text-2xl font-heading mb-1">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
              <div class="text-luxury-taupe text-sm">Satisfaction garantie</div>
            </div>
          </div>
        </div>

        {/* Hero Image */}
        <div class="relative animate-luxury-slide-in" style="animation-delay: 0.3s;">
          <img 
            src="/assets/mariee-annecy.jpg" 
            alt="Maquillage professionnel d'exception √† Annecy" 
            class="rounded-3xl shadow-luxury-strong w-full h-96 lg:h-[500px] object-cover" 
            loading="lazy" 
          />
          
          {/* Floating Cards */}
          <div class="absolute -top-4 -left-4 card-luxury p-4 w-32 text-center animate-luxury-scale-in" style="animation-delay: 0.8s;">
            <div class="text-luxury-primary text-2xl mb-1">üíÑ</div>
            <div class="text-luxury-charcoal text-xs font-medium">Expertise</div>
            <div class="text-luxury-taupe text-xs">Professionnelle</div>
          </div>
          
          <div class="absolute -bottom-4 -right-4 card-luxury p-4 w-32 text-center animate-luxury-scale-in" style="animation-delay: 1s;">
            <div class="text-luxury-primary text-2xl mb-1">‚ú®</div>
            <div class="text-luxury-charcoal text-xs font-medium">R√©sultat</div>
            <div class="text-luxury-taupe text-xs">Sublim√©</div>
          </div>
        </div>
      </div>
    </div>
  </section>
    <div class="container mx-auto flex flex-col md:flex-row items-center gap-10">
      <div class="flex-1 text-center md:text-left">
        <h1 class="text-5xl font-extrabold text-pink-700 mb-4">D√©couvrez nos services de maquillage √† Annecy</h1>
        <p class="text-lg text-gray-700 mb-6 max-w-xl">Maquillage professionnel, artistique, √©v√©nementiel ou formation‚ÄØ: sublimez chaque moment avec l‚Äôexpertise d‚Äôune maquilleuse passionn√©e. R√©servez votre s√©ance ou demandez un devis personnalis√©‚ÄØ!</p>
        <Button href="/contact" variant="primary" size="lg">Demander un devis</Button>
      </div>
      <div class="flex-1 flex justify-center">
        <img src="/assets/mariee-annecy.jpg" alt="Maquillage professionnel Annecy √† Annecy" class="rounded-3xl shadow-2xl w-96 h-72 object-cover border-4 border-pink-200" loading="lazy" />
      </div>
    </div>
  </section>

  {/* Liste des services */}
  <section class="container mx-auto py-8">
    <h2 class="text-3xl font-bold mb-8 text-pink-700 text-center">Nos Services</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
      {services.map((service: any) => (
        <Card class="flex flex-col h-full">
          {service.image ? (
            <img src={service.image} alt={service.nom} class="w-full h-48 object-cover rounded-t-2xl" loading="lazy" />
          ) : (
            <div class="h-48 flex items-center justify-center bg-gray-100 rounded-t-2xl text-gray-400">Aucune image</div>
          )}
          <CardContent class="flex-1 flex flex-col justify-between">
            <div>
              <CardTitle class="mb-2">{service.nom}</CardTitle>
              <div class="flex gap-2 mb-2">
                {service.categorie && <Badge variant="primary">{service.categorie}</Badge>}
                {service.duree && <Badge variant="secondary">{service.duree}</Badge>}
              </div>
              <p class="mb-3 text-gray-700 line-clamp-3">{service.description}</p>
            </div>
            <div class="flex items-center justify-between mt-4">
              <span class="font-bold text-pink-700 text-xl">{service.prix} ‚Ç¨</span>
              <Button href={`/services/${service.slug}`} variant="primary">Voir le service</Button>
            </div>
          </CardContent>
          {/* Section avis r√©sum√© */}
          <div class="px-8 pb-4">
            <ServiceAvisSummary serviceId={service.id} />
          </div>
        </Card>
      ))}
    </div>
  </section>

  {/* Section Avis sur nos services (carousel global) */}

  <section class="container mx-auto py-12">
    <h2 class="text-3xl font-bold mb-6 text-pink-700 text-center">Avis sur nos services</h2>
    <ServicesAvisCarousel avis={allServiceAvis} />
  </section>

  {/* Section Galerie des services (carousel global) */}
  <section class="container mx-auto py-12">
    <h2 class="text-3xl font-bold mb-6 text-pink-700 text-center">Galerie des services</h2>
    <ServicesGalleryCarousel images={allServiceImages} />
  </section>

  {/* Section FAQ services (liste globale) */}
  <section class="container mx-auto py-12">
    <h2 class="text-3xl font-bold mb-6 text-pink-700 text-center">Questions fr√©quentes sur les services</h2>
    <ServicesFaqList faqs={allServiceFaqs} />
  </section>

  {/* CTA final */}
  <section class="container mx-auto py-12 flex flex-col items-center">
    <div class="bg-pink-100 rounded-2xl shadow-lg p-10 flex flex-col items-center max-w-2xl">
      <h3 class="text-2xl font-bold text-pink-700 mb-4 text-center">Pr√™te √† sublimer votre beaut√©‚ÄØ?</h3>
      <p class="text-gray-700 mb-6 text-center">Contactez-moi pour un devis personnalis√© ou r√©servez directement votre s√©ance de maquillage √† Annecy.</p>
      <div class="flex gap-4">
        <Button href="/contact" variant="primary" size="lg">Contact</Button>
        <Button href="/reservations" variant="secondary" size="lg">R√©server</Button>
      </div>
    </div>
  </section>
</Layout>